N1 <-
ERP %>%
select(ssj, epoch_num, time, condition_RQ1, all_of(ROI)) %>% # keep only columns of interest
filter(time >= time_window[1] & time <= time_window[2]) %>% # keep only data in selected time window
na.omit %>% # delete NAs
pivot_longer(
all_of(ROI),
names_to = "electrode",
values_to = "amplitude"
)
project_seed <- 999 # RNG seed
set.seed(project_seed) # set seed
# install packages --------------------------------------------------------------------
# install.packages("here")
# install.packages("tidyverse")
# load packages --------------------------------------------------------------------
library(here)
library(tidyverse)
# set directories for .RData files --------------------------------------------------------------------
# ERPs, all conditions
data_path <- here("data", "processed_data", "ERP", "RData")
# ERPs, RQ1
data_path_RQ1 <- here("data", "processed_data", "ERP", "RData", "RQ1")
# create directory if it doesn't exist
if (dir.exists(data_path_RQ1)) {
print(paste0("The directory '", data_path_RQ1, "' already exists."))
} else {
dir.create(path = data_path_RQ1)
print(paste0("Directory '", data_path_RQ1, "' created."))
}
# setup: N1 --------------------------------------------------------------------
# time window for mean N1
time_window <- c(130, 180)
# electrode ROI (region of interest)
ROI <- c("PO7", "PO3", "O1", "PO4", "PO8", "O2")
stats_list_RData <-
list.files(
path = data_path,
pattern = ".RData"
)
# preallocate data frame with all N1 data
all_N1 <- NULL
i=stats_list_RData[1]
# load .RData
load(here(data_path, i))
N1 <-
ERP %>%
select(ssj, epoch_num, time, condition_RQ1, all_of(ROI)) %>% # keep only columns of interest
filter(time >= time_window[1] & time <= time_window[2]) %>% # keep only data in selected time window
na.omit %>% # delete NAs
pivot_longer(
all_of(ROI),
names_to = "electrode",
values_to = "amplitude"
) %>%
group_by(ssj, epoch_num, condition_RQ1) %>%
summarize(amplitude = mean(amplitude, na.rm = TRUE),
.groups = "keep") %>%
ungroup()
View(N1)
N1 <-
ERP %>%
select(ssj, epoch_num, time, condition_RQ1, all_of(ROI)) %>% # keep only columns of interest
filter(time >= time_window[1] & time <= time_window[2]) %>% # keep only data in selected time window
na.omit %>% # delete NAs
pivot_longer(
all_of(ROI),
names_to = "electrode",
values_to = "amplitude"
)
N1 <-
ERP %>%
select(ssj, epoch_num, time, condition_RQ1, all_of(ROI)) %>% # keep only columns of interest
filter(time >= time_window[1] & time <= time_window[2]) %>% # keep only data in selected time window
na.omit %>% # delete NAs
pivot_longer(
all_of(ROI),
names_to = "electrode",
values_to = "amplitude"
) %>%
group_by(ssj, epoch_num, condition_RQ1) %>%
summarize(amplitude = mean(amplitude, na.rm = TRUE), # average activity in ROI and time window
.groups = "keep") %>%
ungroup()
project_seed <- 999 # RNG seed
set.seed(project_seed) # set seed
# install packages --------------------------------------------------------------------
# install.packages("here")
# install.packages("tidyverse")
# load packages --------------------------------------------------------------------
library(here)
library(tidyverse)
# set directories for .RData files --------------------------------------------------------------------
# ERPs, all conditions
data_path <- here("data", "processed_data", "ERP", "RData")
# ERPs, RQ1
data_path_RQ1 <- here("data", "processed_data", "ERP", "RData", "RQ1")
# create directory if it doesn't exist
if (dir.exists(data_path_RQ1)) {
print(paste0("The directory '", data_path_RQ1, "' already exists."))
} else {
dir.create(path = data_path_RQ1)
print(paste0("Directory '", data_path_RQ1, "' created."))
}
# setup: N1 --------------------------------------------------------------------
# time window for mean N1
time_window <- c(130, 180)
# electrode ROI (region of interest)
ROI <- c("PO7", "PO3", "O1", "PO4", "PO8", "O2")
stats_list_RData <-
list.files(
path = data_path,
pattern = ".RData"
)
# preallocate data frame with all N1 data
all_N1 <- NULL
# yes, I know I shouldn't use loops in R
for (i in stats_list_RData) {
# load .RData
load(here(data_path, i))
# extract N1 amplitude from selected ROI and time window
N1 <-
ERP %>%
select(ssj, epoch_num, time, condition_RQ1, all_of(ROI)) %>% # keep only columns of interest
filter(time >= time_window[1] & time <= time_window[2]) %>% # keep only data in selected time window
na.omit %>% # delete NAs
pivot_longer(
all_of(ROI),
names_to = "electrode",
values_to = "amplitude"
) %>%
group_by(ssj, epoch_num, condition_RQ1) %>%
summarize(amplitude = mean(amplitude, na.rm = TRUE), # average activity in ROI and time window
.groups = "keep") %>%
ungroup()
# all N1 data
all_N1 <- rbind(all_N1, N1)
}
# save as .RData (compressed)
save(
all_N1,
file = here(data_path_RQ1, "RQ1_all_N1.RData" )
)
project_seed <- 999 # RNG seed
set.seed(project_seed) # set seed
# install packages --------------------------------------------------------------------
# install.packages("here")
# install.packages("tidyverse")
# install.packages("brms")
# load packages --------------------------------------------------------------------
library(here)
library(tidyverse)
library(brms)
# setup --------------------------------------------------------------------
# electrode ROI (region of interest)
ROI <- c("PO7", "PO3", "O1", "PO4", "PO8", "O2")
# time window for mean N1
time_window <- c(130, 180)
# setup STAN
num_chains <- 8 # number of chains = number of processor cores
num_iter <- 2000 # number of samples per chain
num_warmup <- 1000 # number of warm-up samples per chain
num_thin <- 1 # thinning: extract one out of x samples per chain
# priors  --------------------------------------------------------------------
# informative priors (based on grand average)
priors <- c(
prior("normal(4, 2)", class = "b", coef = "Intercept"),
prior("normal(0, 3)", class = "b"),
prior("student_t(3, 0, 2)", class = "sd")
)
# load data  --------------------------------------------------------------------
load(here(data_path_RQ1, "RQ1_all_N1.RData"))
load(here("data", "processed_data", "ERP", "RData", "RQ1", "RQ1_all_N1.RData"))
?brm
project_seed <- 999 # RNG seed
set.seed(project_seed) # set seed
# install packages --------------------------------------------------------------------
# install.packages("here")
# install.packages("tidyverse")
# install.packages("brms")
# load packages --------------------------------------------------------------------
library(here)
library(tidyverse)
library(brms)
# set directories --------------------------------------------------------------------
# N1 data
N1_path <- here("data", "processed_data", "ERP", "RData", "RQ1")
# model fit
model_path <- here("data", "processed_data", "ERP", "models")
# create directory if it doesn't exist
if (dir.exists(model_path)) {
print(paste0("The directory '", model_path, "' already exists."))
} else {
dir.create(path = model_path)
print(paste0("Directory '", model_path, "' created."))
}
# model fit
model_path <- here("data", "processed_data", "ERP", "models", "RQ1")
# create directory if it doesn't exist
if (dir.exists(model_path)) {
print(paste0("The directory '", model_path, "' already exists."))
} else {
dir.create(path = model_path)
print(paste0("Directory '", model_path, "' created."))
}
# electrode ROI (region of interest)
ROI <- c("PO7", "PO3", "O1", "PO4", "PO8", "O2")
# time window for mean N1
time_window <- c(130, 180)
# setup: STAN --------------------------------------------------------------------
num_chains <- 8 # number of chains = number of processor cores
num_iter <- 2000 # number of samples per chain
num_warmup <- 1000 # number of warm-up samples per chain
num_thin <- 1 # thinning: extract one out of x samples per chain
# priors  --------------------------------------------------------------------
# informative priors (based on grand average)
priors <- c(
prior("normal(4, 2)", class = "b", coef = "Intercept"),
prior("normal(0, 3)", class = "b"),
prior("student_t(3, 0, 2)", class = "sd")
)
# load data  --------------------------------------------------------------------
load(here(N1_path, "RQ1_all_N1.RData"))
here(model_path, "N1_brms.rds")
N1_brms <-
brm(
amplitude ~ 0 + Intercept + condition + (1 + condition | ssj),
# amplitude ~ 0 + Intercept + condition + (1 + condition | ssj) + (1 + condition  | epoch_num),
data = all_N1,
family = gaussian(),
prior = priors,
inits = "random",
control = list(
adapt_delta = .99,
max_treedepth = 15
),
chains = num_chains,
iter = num_iter,
warmup = num_warmup,
thin = num_thin,
algorithm = "sampling",
cores = num_chains,
seed = project_seed,
file = here(model_path, "N1_brms.rds"),
file_refit = "on_change" # plausible options: "on_change" or "always"
)
all_N1
N1_brms <-
brm(
amplitude ~ 0 + Intercept + condition_RQ1 + (1 + condition_RQ1 | ssj),
# amplitude ~ 0 + Intercept + condition_RQ1 + (1 + condition_RQ1 | ssj) + (1 + condition_RQ1  | epoch_num),
data = all_N1,
family = gaussian(),
prior = priors,
inits = "random",
control = list(
adapt_delta = .99,
max_treedepth = 15
),
chains = num_chains,
iter = num_iter,
warmup = num_warmup,
thin = num_thin,
algorithm = "sampling",
cores = num_chains,
seed = project_seed,
file = here(model_path, "N1_brms.rds"),
file_refit = "on_change" # plausible options: "on_change" or "always"
)
N1_brms
# RNG --------------------------------------------------------
project_seed <- 999 # RNG seed
set.seed(project_seed) # set seed
# install packages --------------------------------------------------------------------
# install.packages("Rmisc")
# install.packages("here")
# install.packages("tidyverse")
# install.packages("viridis")
# install.packages("remotes")
# remotes::install_github("craddm/eegUtils")
# load packages --------------------------------------------------------------------
library(Rmisc) # must be loaded before tidyverse (beware some nasty function masking!)
library(here)
library(tidyverse)
library(viridis)
library(eegUtils)
# setup: channels --------------------------------------------------------------------
# list channels to exclude (non-scalp)
exclude_chans <-
c(
"VEOG", "HEOG", "IO1", "IO2", "Afp9", "Afp10", # ocular channels
"M1", "M2" # mastoid channels
)
# load electrode locations
chan_locs <-
import_chans(
here("data", "original_data", "channel_locations", "chanlocs_ced.txt"),
format = "spherical",
file_format = "ced"
) %>%
filter(!electrode %in% exclude_chans) # exclude non-scalp channels
# setup: plots --------------------------------------------------------------------
# custom ggplot theme
source(here("scripts", "analysis", "functions", "custom_ggplot_theme.R"))
# time points for topographies
topo_times <- c(0, 23, 55, 78, 102, 125, 148, 172, 203)
# the values below are obtained by visual inspection, but
# they are included at the beginning of the script for convenience
# time window for mean N1
time_window <- c(130, 180)
# electrode ROI (region of interest)
ROI <- c("PO7", "PO3", "O1", "PO4", "PO8", "O2")
# load and prepare data --------------------------------------------------------------------
# load .RData
load(here("data", "processed_data", "ERP", "RData", "RQ1", "RQ1_plot_all_data.RData"))
# plot topographies --------------------------------------------------------------------
# by plotting topographies, we will identify
# the electrodes from which we can prominently record the N1
# yes, I know I shouldn't use loops in R
for (i in topo_times) {
# plot topography
topo <-
plot_all_data %>%
filter(time == i) %>% # keep only data in time window of interest
group_by(electrode) %>%
summarize(amplitude = mean(amplitude, na.rm = TRUE), # average across time
.groups = "keep") %>%
ungroup() %>%
topoplot(
limits = c(-4, 4),
chanLocs = chan_locs,
method = "Biharmonic",
palette = "viridis",
interp_limit = "skirt",
contour = TRUE,
chan_marker = "point", # use "name" to see electrode label
quantity = "amplitude",
scaling = 2 # scale labels and lines
) +
ggtitle(paste0(i, " ms")) +
theme(plot.title = element_text(size = 28, hjust = .5, face = "bold"))
print(topo)
}
# the ROI (region of interest) comprises the following electrodes:
# "PO7", "PO3", "O1", "PO4", "PO8", "O2"
# plot time series (grand average, only ROI) --------------------------------------------------------------------
timeseries_grand_average_ROI <-
plot_all_data %>%
filter(electrode %in% ROI) %>% # keep only electrodes in ROI
group_by(ssj, electrode, time) %>%
summarize(amplitude = mean(amplitude, na.rm = TRUE),# average across conditions
.groups = "keep") %>%
ungroup() %>%
pivot_wider(
id_cols = c(ssj, time),
names_from = electrode,
values_from = amplitude
) %>%
mutate(ROI_amplitude = rowMeans(select(., all_of(ROI)), na.rm = TRUE)) %>%
summarySE( # average across participants
data = .,
measurevar = "ROI_amplitude",
groupvars = "time",
na.rm = FALSE,
conf.interval = .95
) %>%
as_tibble
timeseries_grand_average_ROI %>%
ggplot(
aes(
x = time,
y = ROI_amplitude
)
) +
geom_vline( # vertical reference line
xintercept = 0,
linetype = "dashed",
color = "black",
size = 1.2,
alpha = .8
) +
geom_hline( # horizontal reference line
yintercept = 0,
linetype = "dashed",
color = "black",
size = 1.2,
alpha = .8
) +
geom_line( # one line per electrode
size = 1,
color = "#3B528BFF", # blue
alpha = .6
) +
geom_ribbon( # 95% CI
aes(
ymin = ROI_amplitude - ci,
ymax = ROI_amplitude + ci
),
# linetype = "dotted",
color = "#3B528BFF", # blue
size = .1,
alpha = .1,
show.legend = FALSE
) +
labs(
title = "grand average (ROI)", # title & axes labels
x = "time (ms)",
y = expression(paste("amplitude (", mu, "V)"))
) +
scale_x_continuous(breaks = seq(-200, 500, 100)) + # x-axis: tick marks
scale_y_reverse(
breaks = seq(-2, 14, 2), # y-axis: tick marks
limits = c(14, -2)
) +
annotate("rect",
xmin = time_window[1],
xmax = time_window[2],
ymin = 1,
ymax = 8,
linetype = "solid",
size = 1.5,
color = "#de1d1d",
alpha = 0
) +
theme_custom
# based on the grand average, we identify
# a time window for the N1 between 130 - 180 ms
# topography in selected time window --------------------------------------------------------------------
plot_all_data %>%
filter(time >= time_window[1] & time <= time_window[2]) %>% # keep only data in time window of interest
group_by(electrode) %>%
summarize(amplitude = mean(amplitude, na.rm = TRUE), # average across time
.groups = "keep") %>%
ungroup() %>%
topoplot(
chanLocs = chan_locs,
method = "Biharmonic",
palette = "viridis",
interp_limit = "skirt",
contour = TRUE,
chan_marker = "point", # use "name" to see electrode label
quantity = "amplitude",
highlights = ROI,
scaling = 2 # scale labels and lines
) +
ggtitle(paste0(time_window[1], " - ", time_window[2], " ms")) +
theme(plot.title = element_text(size = 28, hjust = .5, face = "bold"))
# END --------------------------------------------------------------------
# RNG --------------------------------------------------------
project_seed <- 999 # RNG seed
set.seed(project_seed) # set seed
# install packages --------------------------------------------------------------------
# install.packages("here")
# install.packages("tidyverse")
# install.packages("brms")
# load packages --------------------------------------------------------------------
library(here)
library(tidyverse)
library(brms)
# set directories --------------------------------------------------------------------
# N1 data
N1_path <- here("data", "processed_data", "ERP", "RData", "RQ1")
# model fit
model_path <- here("data", "processed_data", "ERP", "models", "RQ1")
# create directory if it doesn't exist
if (dir.exists(model_path)) {
print(paste0("The directory '", model_path, "' already exists."))
} else {
dir.create(path = model_path)
print(paste0("Directory '", model_path, "' created."))
}
# setup: N1 --------------------------------------------------------------------
# electrode ROI (region of interest)
ROI <- c("PO7", "PO3", "O1", "PO4", "PO8", "O2")
# time window for mean N1
time_window <- c(130, 180)
# setup: STAN --------------------------------------------------------------------
num_chains <- 8 # number of chains = number of processor cores
num_iter <- 2000 # number of samples per chain
num_warmup <- 1000 # number of warm-up samples per chain
num_thin <- 1 # thinning: extract one out of x samples per chain
# priors  --------------------------------------------------------------------
# informative priors (based on grand average)
priors <- c(
prior("normal(4, 2)", class = "b", coef = "Intercept"),
prior("normal(0, 3)", class = "b"),
prior("student_t(3, 0, 2)", class = "sd")
)
# load data  --------------------------------------------------------------------
load(here(N1_path, "RQ1_all_N1.RData"))
N1_brms <-
brm(
# amplitude ~ 0 + Intercept + condition_RQ1 + (1 + condition_RQ1 | ssj),
amplitude ~ 0 + Intercept + condition_RQ1 + (1 + condition_RQ1 | ssj) + (1 + condition_RQ1  | epoch_num),
data = all_N1,
family = gaussian(),
prior = priors,
inits = "random",
control = list(
adapt_delta = .99,
max_treedepth = 15
),
chains = num_chains,
iter = num_iter,
warmup = num_warmup,
thin = num_thin,
algorithm = "sampling",
cores = num_chains,
seed = project_seed,
file = here(model_path, "N1_brms.rds"),
file_refit = "on_change" # plausible options: "on_change" or "always"
)
